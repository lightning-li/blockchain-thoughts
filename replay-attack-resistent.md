#### 区块链抵抗重放攻击的几种方法

重放攻击，指攻击者重放一个在网络上窃听到的或在区块链中看到的消息。这里，重放攻击是一个很严重的问题。在 Ethereum 中，重放攻击一笔交易会导致源账户中的余额反复减少，目标账户中的余额反复增多，若目标账户是一个合约账户，会反复调用目标账户中的合约代码，导致目标账户中 `storageRoot` 的改变，这一切都会导致 `World State` 的改变；在 Hyperledger fabric 中，重放攻击能使验证实体重复做计算上敏感的过程 (链上编码唤醒操作) 和 (或者) 影响相应链上编码的状态，然而却不需要消耗攻击者的计算资源或者说很小的计算资源。更糟糕的是，如果该交易是一笔付款交易，重放攻击能导致多次付款，却不需要来自付款者的同意。现有的系统使用以下方法阻止重放攻击：

- 在系统中记录交易的哈希值。这个解决方案需要验证节点维护一个已经执行过的每笔交易哈希值的日志，然后接收到或执行一笔新交易的时候，将其与他们本地存储的交易记录进行比对。很明显，这种解决办法不能适应大型网络的需要，很容易就导致验证者花费大量时间去检查一笔交易是否被重放，比执行交易的时间都要长。

- 利用每个用户实体维护的状态 (Ethereum)。Ethereum 中，每一个账户都有一个 `nonce`，该值等于从该账户中发出的交易。如果该账户是一个合约账户，该值等于由该合约账户创建的新合约账户的数量。当一笔交易被矿工验证是否有效的时候，矿工会比对交易中的 `nonce` 与该交易的发送者账户中的 `nonce` 是否相等，交易其它验证通过和执行完成后，发送者账户中的 `nonce` 会自增 1，因此当有重复交易过来的时候，会直接被判为无效，从而阻止了重放攻击。这种方法对于存在有限实体账户的系统来说工作地很好，但是对于用户的每笔交易使用不同标识的系统来说 (fabric 中的 Tcert 交易证书)，这种方法从根本上扩展性也不高，因为将有与交易数量成比例的大量用户笔名 (一个用户对应着很多 Tcert 即笔名)。
